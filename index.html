<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Universal Android Debloater - Web</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!--
    =========================================================================
    Universal Android Debloater - Web Application
    =========================================================================
    
    This web application allows users to manage Android packages via WebUSB.
    It connects directly to Android devices over USB without requiring any
    server-side components or the traditional `adb` command-line tool.
    
    LAYOUT STRUCTURE:
    - Header: App title and connection status indicator
    - Top Row: USB Connection panel and Saved Lists panel (side by side)
    - Apps Panel: Full width, contains package list and bulk actions
    - Log Panel: Full width, shows operation log
    
    REQUIREMENTS:
    - Chrome/Edge browser with WebUSB support
    - Android device with USB debugging enabled
    - USB cable connected to computer
    - No `adb server` running (it would block WebUSB access)
    =========================================================================
    -->

    <!-- ===================================================================
         HEADER
         Contains the app title and connection status indicator.
         The status indicator changes color based on connection state.
    ==================================================================== -->
    <header class="app-header">
      <h1>Universal Android Debloater - Web</h1>
      <!-- 
        Connection status badge - updated by JavaScript
        CSS class "connected" is toggled to change appearance
      -->
      <div class="status" id="connectionStatus">Disconnected</div>
    </header>

    <main class="layout">
      <!-- =================================================================
           TOP ROW - USB Connection and Saved Lists panels
           Uses CSS Grid with 2 columns on larger screens,
           stacks vertically on smaller screens.
      ================================================================== -->
      <div class="top-row">
        
        <!-- =============================================================
             USB CONNECTION PANEL
             
             Elements:
             - selectUsbBtn: Opens WebUSB device picker dialog
             - connectUsbBtn: Initiates ADB connection to selected device
             - disconnectUsbBtn: Disconnects from current device
             - deviceInfo: Shows connected device information
             - streamTimeout: Configurable timeout for ADB operations
        ============================================================== -->
        <section class="panel">
          <h2>USB Connection</h2>
          <div class="row">
            <button id="selectUsbBtn" class="ghost">Select Device</button>
            <button id="connectUsbBtn" class="primary">Connect</button>
            <button id="disconnectUsbBtn" class="ghost" disabled>Disconnect</button>
          </div>
          <div class="device-meta muted" id="deviceInfo">No device connected.</div>
          <label class="field">
            <span>Timeout (ms)</span>
            <!-- 
              Timeout value in milliseconds for ADB stream operations.
              Default is 5000ms (5 seconds).
              Increase for slow devices or large package lists.
            -->
            <input id="streamTimeout" type="number" min="1000" value="5000" />
          </label>
        </section>

        <!-- =============================================================
             SAVED LISTS PANEL
             
             Allows users to save, load, and manage named package lists.
             
             Elements:
             - savedListName: Input for new list name
             - saveListBtn: Save current selection as named list
             - savedListsSelect: Dropdown of saved lists
             - loadListBtn: Load selected list
             - deleteListBtn: Delete selected list
             - loadLastBtn: Load auto-saved last selection
             - exportListBtn: Export list as JSON file
             - importListBtn: Import list from JSON file
             - importFileInput: Hidden file input for import
        ============================================================== -->
        <section class="panel">
          <h2>Saved Lists</h2>
          <div class="row">
            <input id="savedListName" type="text" placeholder="list name" style="flex:1" />
            <button id="saveListBtn" class="primary">Save</button>
          </div>
          <div class="row">
            <select id="savedListsSelect" style="flex:1"></select>
            <button id="loadListBtn" class="ghost">Load</button>
            <button id="deleteListBtn" class="ghost">Delete</button>
          </div>
          <div class="row">
            <button id="loadLastBtn" class="ghost">Last</button>
            <button id="exportListBtn" class="ghost">Export</button>
            <button id="importListBtn" class="ghost">Import</button>
            <!-- Hidden file input - triggered by Import button click -->
            <input type="file" id="importFileInput" accept=".json,.txt" style="display:none" />
          </div>
          <div class="device-meta muted" id="savedListInfo">
            <span id="lastSelectedInfo"></span>
          </div>
        </section>

      </div>

      <!-- =================================================================
           APPS PANEL
           
           Full-width panel showing the list of installed packages.
           
           Header Row Elements:
           - loadAppsBtn: Fetch package list from connected device
           - selectAllBtn: Select all visible packages
           - clearSelectionBtn: Deselect all packages
           - selectionCount: Badge showing number of selected packages
           - packageCount: Badge showing number of visible packages
           - separator: Visual divider
           - disableBtn: Disable selected packages (bulk action)
           - enableBtn: Enable selected packages (bulk action)
           - uninstallBtn: Uninstall selected packages (bulk action)
           - filterInput: Text input to filter package list
           
           List:
           - appList: UL element dynamically populated with package items
      ================================================================== -->
      <section class="panel apps-panel">
        <div class="row">
          <h2 style="margin:0">Apps</h2>
          <button id="loadAppsBtn" class="primary">List Apps</button>
          <button id="selectAllBtn" class="ghost">Select All</button>
          <button id="clearSelectionBtn" class="ghost">Clear</button>
          <div class="badge" id="selectionCount">0 selected</div>
          <div class="badge" id="packageCount">0 total</div>
          <!-- Visual separator between selection controls and bulk actions -->
          <span class="separator"></span>
          <!-- Bulk action buttons operate on all selected packages -->
          <button id="disableBtn" class="danger">Disable Selected</button>
          <button id="enableBtn" class="ghost">Enable Selected</button>
          <button id="uninstallBtn" class="danger">Uninstall Selected</button>
          <input id="filterInput" type="text" placeholder="Filter..." style="margin-left:auto; width:200px" />
        </div>
        <!-- 
          Package list container - populated dynamically by JavaScript
          Each item contains:
          - Checkbox for selection
          - Package name
          - Enable/Disable button (changes based on current state)
          - Uninstall button
        -->
        <ul id="appList" class="app-list"></ul>
      </section>

      <!-- =================================================================
           LOG PANEL
           
           Shows a scrollable log of operations performed.
           Useful for tracking what actions were taken and their results.
           
           Elements:
           - copyLogBtn: Copy log contents to clipboard
           - logOutput: Scrollable container for log messages
      ================================================================== -->
      <section class="panel">
        <div class="panel-header">
          <h2>Log</h2>
          <button id="copyLogBtn" class="ghost small-button">Copy</button>
        </div>
        <!-- 
          Log output container
          - aria-live="polite" for accessibility (screen readers announce changes)
          - Scrollable with max-height defined in CSS
          - Text is appended by JavaScript with timestamps
        -->
        <div id="logOutput" class="log-output" aria-live="polite"></div>
      </section>
    </main>

    <!-- 
      Main application JavaScript module
      Uses ES modules (type="module") for clean imports
      All UI logic and ADB communication is handled here
    -->
    <script type="module" src="js/app.js"></script>
  </body>
</html>
